<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Protocol/NOTE-Protocol-V2-English" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">NOTE Protocol(draft) | Note Protocol</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://noteprotocol.org/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://noteprotocol.org/img/social-card.png"><meta data-rh="true" property="og:url" content="https://noteprotocol.org/docs/Protocol/NOTE-Protocol-V2-English"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="NOTE Protocol(draft) | Note Protocol"><meta data-rh="true" name="description" content="1. Introduction"><meta data-rh="true" property="og:description" content="1. Introduction"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://noteprotocol.org/docs/Protocol/NOTE-Protocol-V2-English"><link data-rh="true" rel="alternate" href="https://noteprotocol.org/docs/Protocol/NOTE-Protocol-V2-English" hreflang="en"><link data-rh="true" rel="alternate" href="https://noteprotocol.org/docs/Protocol/NOTE-Protocol-V2-English" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Note Protocol RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Note Protocol Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-T6CXC4X888"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-T6CXC4X888",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.75c1afc6.css">
<script src="/assets/js/runtime~main.3f27cd56.js" defer="defer"></script>
<script src="/assets/js/main.33e5a258.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Note Protocol" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="Note Protocol" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Note Protocol</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/NoteProtocol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/Protocol/NOTE-Protocol-V2-Chinese">Protocol</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Protocol/NOTE-Protocol-V2-Chinese">NOTE协议(draft)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Protocol/NOTE-Protocol-V2-English">NOTE Protocol(draft)</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Protocol</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">NOTE Protocol(draft)</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>NOTE Protocol(draft)</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-introduction">1. Introduction<a href="#1-introduction" class="hash-link" aria-label="Direct link to 1. Introduction" title="Direct link to 1. Introduction">​</a></h2>
<p>The NOTE protocol enables blockchain systems based on the Bitcoin UTXO model to create and manage digital assets. This protocol supports secure encrypted data storage and communication, and is also applicable to public and transparent data storage, including the management of ownership rights for digital assets such as Tokens and NFTs.</p>
<p>This protocol is grounded in the BIP32 standard to determine the generation rules for Decentralized Identities (DID).</p>
<p>For encrypted data, the protocol employs DID rules. Each record is encrypted and decrypted with unpredictable random public and private keys, using the Electrum BIE1 ECIES algorithm for data encryption.</p>
<p>The protocol specifies the data storage format and defines the rules for data creation, deletion, modification, retrieval, and sharing.</p>
<p>Information security does not rely on third-party trust; only the holders of mnemonic phrases can access the data, ensuring both data and storage security.</p>
<p>Utilizing on-chain smart contracts for Bitcoin consensus-level asset verification, combined with off-chain asset indexers, the protocol efficiently interprets on-chain assets and provides Merkle proofs for these assets.</p>
<p>This is a second-layer solution built upon the unshakeable Bitcoin protocol and its underlying blockchain consensus rules. The protocol also lays the foundational application requirements for Layer 2 networks.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-problems-solved-and-solutions-by-the-protocol">2. Problems Solved and Solutions by the Protocol<a href="#2-problems-solved-and-solutions-by-the-protocol" class="hash-link" aria-label="Direct link to 2. Problems Solved and Solutions by the Protocol" title="Direct link to 2. Problems Solved and Solutions by the Protocol">​</a></h2>
<p>Based on the characteristics of blockchains using the UTXO model, this protocol addresses the following issues:</p>
<ul>
<li>Decentralized Identity (DID)</li>
<li>Data Format</li>
<li>Data Storage Location</li>
<li>Confirmation of Data Ownership</li>
<li>Transfer of Ownership</li>
<li>On-chain Contracts</li>
<li>Data Parsing</li>
<li>Data Indexing</li>
<li>Asset Creation</li>
<li>Asset Mining</li>
<li>Asset Transfer</li>
<li>Asset Destruction</li>
<li>Asset Notification</li>
<li>Asset Proof</li>
</ul>
<p>During the design process, considerations were made for transaction sequencing to prevent double spending, reduce data redundancy on the blockchain, and avoid accidental asset consumption.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-system-relationship-diagram">2.1 System Relationship Diagram<a href="#21-system-relationship-diagram" class="hash-link" aria-label="Direct link to 2.1 System Relationship Diagram" title="Direct link to 2.1 System Relationship Diagram">​</a></h3>
<p>As shown in the diagram below, asset private keys are generated and stored in user wallets or related software. Once data asset transactions are broadcasted to the blockchain, the blockchain ensures transparency of information and its irreversibility, clearly defining the timing and sequence of transactions, and verifying ownership signatures through on-chain smart contracts. Data indexers and validators are responsible for interpreting transaction data, executing off-chain smart contracts, and providing Merkle proofs of assets. Data indexers will evolve into a Layer 2 network with a consensus mechanism.</p>
<p><img loading="lazy" alt="Arch" src="/assets/images/arch-92e6861beee31de4a7cc7c2d598e2a39.png" width="1468" height="962" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-decentralized-id">2.2 Decentralized ID<a href="#22-decentralized-id" class="hash-link" aria-label="Direct link to 2.2 Decentralized ID" title="Direct link to 2.2 Decentralized ID">​</a></h3>
<p>On users&#x27; end devices (such as mobile phones or computers), account public and private keys, along with private keys for data encryption, are derived based on the BIP32 protocol. Serving as decentralized identities, these keys utilize the publicly accessible account public key for user identification. This identity is used in all scenarios including ownership confirmation, signing, data creation, and sharing.</p>
<p><img loading="lazy" alt="DID" src="/assets/images/did-b62506c8bf4a02aef39c9e34533942d2.png" width="2088" height="1878" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="221-account-keys">2.2.1 Account Keys<a href="#221-account-keys" class="hash-link" aria-label="Direct link to 2.2.1 Account Keys" title="Direct link to 2.2.1 Account Keys">​</a></h4>
<p>Account keys are derived following this path:</p>
<p><code>m/purpose&#x27;/coin_type&#x27;/account&#x27;/target/index</code></p>
<p>In the NOTE.SV software, the following variables are used:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">purpose = 44</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">coin_type=236</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">account=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">index=0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Thus, the complete derivation path is:</p>
<p><code>m/44&#x27;/236&#x27;/0&#x27;/0/0</code></p>
<p>By sequentially increasing the index, multiple accounts can be created.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="222-derivation-of-data-encryption-keys">2.2.2 Derivation of Data Encryption Keys<a href="#222-derivation-of-data-encryption-keys" class="hash-link" aria-label="Direct link to 2.2.2 Derivation of Data Encryption Keys" title="Direct link to 2.2.2 Derivation of Data Encryption Keys">​</a></h4>
<p>The derivation path for data encryption keys is defined as follows:</p>
<p><code>m/purpose&#x27;/coin_type&#x27;/account&#x27;/target/quotient/remainder</code></p>
<p>In the NOTE.SV software, the following variables are used:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">purpose = 44</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">coin_type = 236</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">account = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target = 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The steps for generating the derivation path are as follows:</p>
<ol>
<li>Randomly generate a 64-bit integer n.</li>
<li>Following the IEEE754 standard, modulate the random number <code>n % (2^53-2) + 1</code> to generate the derivation index.</li>
<li>Divide the derivation index by Hardened to obtain the quotient and remainder. The code is as follows:<!-- -->
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Hardened </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x80000000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> quotient </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">floor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> Hardened</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> remainder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> Hardened</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p>The complete derivation path is:</p>
<p><code>m/44&#x27;/236&#x27;/0&#x27;/2/${quotient}/${remainder}</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-data-format-and-order">2.3 Data Format and Order<a href="#23-data-format-and-order" class="hash-link" aria-label="Direct link to 2.3 Data Format and Order" title="Direct link to 2.3 Data Format and Order">​</a></h3>
<p>The format and order of data on the blockchain are stipulated as follows:</p>
<ul>
<li>Public Key HASH: The HASH160 of the holder&#x27;s account public key.</li>
<li>Plaintext HASH:<!-- -->
<ul>
<li>If it is encrypted information, then it is the SHA256 value of the plaintext.</li>
<li>If it is public data, then it is 0x00.</li>
</ul>
</li>
<li>Data: Plaintext or ciphertext. Data can be either encrypted or public. Original data should be encoded using the <a href="https://msgpack.org/" target="_blank" rel="noopener noreferrer">Msgpack</a> protocol with sorted keys (sortKeys=true).</li>
<li>Signature: A signature made using the holder&#x27;s account private key on the plaintext HASH. This signature can be verified using the holder&#x27;s account public key. The signature algorithm uses the Bitcoin Message standard. If a public key signature for the transaction can be provided, this field is 0x00; otherwise, a signature is required.</li>
<li>Additional Information: Describes the data representation form<!-- -->
<ul>
<li>A 1-byte integer 0x00, indicating the data is encrypted using the holder&#x27;s account public key.</li>
<li>A 1-byte integer 0xff, indicating the data is unencrypted.</li>
<li>An 8-byte integer, range: 1 to 2^53 - 1, indicating the data is encrypted using the data encryption public key.</li>
</ul>
</li>
<li>NOTE: All uppercase, fixed protocol identifier.</li>
</ul>
<p><img loading="lazy" alt="Data" src="/assets/images/data_en-5a9d47a4bcdbbdff6aa27e41f282ba9c.png" width="2282" height="1244" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-storage-location">2.4 Storage Location<a href="#24-storage-location" class="hash-link" aria-label="Direct link to 2.4 Storage Location" title="Direct link to 2.4 Storage Location">​</a></h3>
<p>Data is required to be placed in the unlocking script of a transaction. During the unlocking process, miners verify the transaction signature and other unlocking conditions. At the same time, it is required that the output section includes a corresponding script output to form a transaction chain. Indexers will determine the execution order of transactions based on the block and UTXO transaction chain, thereby verifying the validity of asset transactions. The unlocking signature flag for this type of transaction is set to SINGLE | ANYONECANPAY.
This protocol uses non-standard scripts, which, unlike standard scripts such as P2PKH, prevent the accidental consumption of UTXOs.
An example of the simplest Bitcoin script used in this protocol is as follows.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="241-non-standard-scripts">2.4.1 Non-standard Scripts<a href="#241-non-standard-scripts" class="hash-link" aria-label="Direct link to 2.4.1 Non-standard Scripts" title="Direct link to 2.4.1 Non-standard Scripts">​</a></h4>
<p>Non-standard scripts are defined in the following format:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Unlocking Script: Transaction Signature, Public Key HASH, Plaintext Data Hash, Data, Data Signature, Additional Information.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Locking Script: NOTE, OP_2DROP, OP_2DROP, OP_2DROP, Original Public Key, OP_CHECKSIG.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Transaction Output: NOTE, OP_2DROP, OP_2DROP, OP_2DROP, New Public Key, OP_CHECKSIG.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="242-using-p2wsh">2.4.2 Using P2WSH<a href="#242-using-p2wsh" class="hash-link" aria-label="Direct link to 2.4.2 Using P2WSH" title="Direct link to 2.4.2 Using P2WSH">​</a></h4>
<p>In blockchains supporting P2WSH, the format is defined as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Unlocking Script: Transaction Signature, Public Key HASH, Plaintext Data Hash, Data, Data Signature, Additional Information.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Locking Script: NOTE, OP_2DROP, OP_2DROP, OP_2DROP, Original Public Key, OP_CHECKSIG.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Output Script: NOTE, OP_2DROP, OP_2DROP, OP_2DROP, New Public Key, OP_CHECKSIG.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Script Address: HASH address of the redemption script.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Data information is stored in the segregated witness data area.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="243-using-p2tr">2.4.3 Using P2TR<a href="#243-using-p2tr" class="hash-link" aria-label="Direct link to 2.4.3 Using P2TR" title="Direct link to 2.4.3 Using P2TR">​</a></h4>
<p>Similar to P2WSH, the redemption script serves as an unlocking branch of MAST, unlocked by a script containing data unlocking instructions.
In blockchains supporting P2TR, the format is defined as follows:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Unlocking Script: Transaction Signature, Public Key HASH, Plaintext Data Hash, Data, Data Signature, Additional Information.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Locking Branch Script: NOTE, OP_2DROP, OP_2DROP, OP_2DROP, Public Key, OP_CHECKSIG.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Output Branch Script: NOTE, OP_2DROP, OP_2DROP, OP_2DROP, Public Key, OP_CHECKSIG.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Transaction Output: Taproot address output.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Unlocking script information is stored in the segregated witness data area.</p>
<p>Using non-standard scripts and P2WSH is recommended for clearer semantics. P2TR MAST can provide more complex transaction logic but may lead to more complex indexer designs.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="25-on-chain-contracts">2.5 On-Chain Contracts<a href="#25-on-chain-contracts" class="hash-link" aria-label="Direct link to 2.5 On-Chain Contracts" title="Direct link to 2.5 On-Chain Contracts">​</a></h3>
<p>More complex locking scripts can be used to create on-chain smart contracts, ensuring that only transactions meeting the contract&#x27;s conditions can be confirmed on the blockchain. Below is a simple example: This script requires that, in addition to a signature, a specific message must be provided in order to initiate a transaction and successfully record the information on the blockchain.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Scryptdemo</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">SmartContract</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">prop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> note</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ByteString </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toByteString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;NOTE&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">prop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pubKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PubKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">prop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hash</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ByteString</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hash</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Sha256</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">...</span><span class="token plain">arguments</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hash </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">method</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">unlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sig</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Sig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ByteString</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        owner</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ByteString</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        plainHash</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ByteString</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ByteString</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hashSig</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ByteString</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        extra</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> bigint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Scryptdemo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">note</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// owner</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// plainHash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// hashSig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// extra</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">sha256</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hash</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Hash does not match&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">checkSig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pubKey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;signature check failed&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The compiled script is</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">044e4f54450000&lt;hash&gt;6175615279755879a85179876959795279ac77777777777777777777</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ASM:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">4e4f5445 </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">hash</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_NOP</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_DROP</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_NOP</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_2</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_PICK</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_DROP</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_8</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_PICK</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_SHA256</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_1</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_PICK</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_EQUAL</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_VERIFY</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_9</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_PICK</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_2</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_PICK</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_CHECKSIG</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_NIP</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_NIP</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_NIP</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_NIP</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_NIP</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_NIP</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_NIP</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_NIP</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_NIP</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">OP_NIP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>The example contract is created using <a href="https://Scrypt.io" target="_blank" rel="noopener noreferrer">Scrypt</a>.</p>
</blockquote>
<p>Whether it&#x27;s the simplest contract or more complex ones, in the transaction script formed by the unlocking and locking scripts, the format and order of data must comply with the regulations of this protocol. With support for smart contracts, functionalities like on-chain Oracles and Swaps will also become possible.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="26-data-ownership-confirmation">2.6 Data Ownership Confirmation<a href="#26-data-ownership-confirmation" class="hash-link" aria-label="Direct link to 2.6 Data Ownership Confirmation" title="Direct link to 2.6 Data Ownership Confirmation">​</a></h3>
<p>To record data on the blockchain, it must be done by spending a UTXO defined by this protocol and completing either a transaction signature or a data signature. On-chain miners and off-chain indexers and wallets confirm data ownership by checking the signature. The UTXO chain ensures the order of transactions, preventing double-spending. The option to choose between a data signature and a transaction signature allows third parties to pay transaction fees. If no data signature is provided, the signer of the transaction is considered the data owner.
Data ownership can be confirmed by the following steps:</p>
<ol>
<li>
<p>If a data signature exists, first check the holder&#x27;s data signature, extract the public key, and verify it together with the holder&#x27;s public key HASH. If the verification passes, the ownership belongs to the public key holder. If not, the transaction is deemed illegal.</p>
</li>
<li>
<p>If no data signature is provided, the public key used to unlock the transaction is considered the data owner.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="27-transfer-of-ownership">2.7 Transfer of Ownership<a href="#27-transfer-of-ownership" class="hash-link" aria-label="Direct link to 2.7 Transfer of Ownership" title="Direct link to 2.7 Transfer of Ownership">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="271-when-providing-a-data-signature">2.7.1 When Providing a Data Signature<a href="#271-when-providing-a-data-signature" class="hash-link" aria-label="Direct link to 2.7.1 When Providing a Data Signature" title="Direct link to 2.7.1 When Providing a Data Signature">​</a></h4>
<ol>
<li>Obtain the recipient&#x27;s public key.</li>
<li>Calculate the HASH of the recipient&#x27;s public key.</li>
<li>Sign using the sender&#x27;s account private key.</li>
<li>The payer or sender signs the transaction with their private key.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="272-when-no-data-signature-is-provided">2.7.2 When No Data Signature is Provided<a href="#272-when-no-data-signature-is-provided" class="hash-link" aria-label="Direct link to 2.7.2 When No Data Signature is Provided" title="Direct link to 2.7.2 When No Data Signature is Provided">​</a></h4>
<ol>
<li>Obtain the recipient&#x27;s public key.</li>
<li>Direct the transaction output to the recipient&#x27;s public key script or the HASH of the public key script.</li>
<li>Set the recipient&#x27;s HASH data to 0x00 to save transaction space.</li>
<li>The sender signs the transaction using their private key.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="28-data-parsing">2.8 Data Parsing<a href="#28-data-parsing" class="hash-link" aria-label="Direct link to 2.8 Data Parsing" title="Direct link to 2.8 Data Parsing">​</a></h3>
<p>After a transaction is published to the blockchain, data indexers parse the transaction, checking the signatures to ensure ownership complies with the protocol, and analyzing the data content to determine its validity. Non-compliant transactions will be discarded. A large volume of non-compliant transactions can be flagged by spam filters.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-encrypted-data">3. Encrypted Data<a href="#3-encrypted-data" class="hash-link" aria-label="Direct link to 3. Encrypted Data" title="Direct link to 3. Encrypted Data">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-creation-of-data">3.1 Creation of Data<a href="#31-creation-of-data" class="hash-link" aria-label="Direct link to 3.1 Creation of Data" title="Direct link to 3.1 Creation of Data">​</a></h3>
<p>The creation of encrypted data follows these steps:</p>
<ol>
<li>Prepare plaintext data content.</li>
<li>Package the data using msgpack.</li>
<li>Obtain the SHA256 HASH of the packaged data.</li>
<li>Generate a random number, create a derivation index, and derive an encryption private key based on the index.</li>
<li>Encrypt the data using the derived public key.</li>
<li>Sign the encrypted data using the account private key with a Bitcoin Message signature.</li>
<li>Construct the data script.</li>
<li>Construct and broadcast the transaction.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-sharing-of-signed-encrypted-data">3.2 Sharing of Signed Encrypted Data<a href="#32-sharing-of-signed-encrypted-data" class="hash-link" aria-label="Direct link to 3.2 Sharing of Signed Encrypted Data" title="Direct link to 3.2 Sharing of Signed Encrypted Data">​</a></h3>
<p>When transferring encrypted data, follow these steps:</p>
<ol>
<li>Set the additional data to 0 when transferring encrypted data.</li>
<li>Obtain the public key of the counterparty.</li>
<li>Encrypt the data using the counterparty&#x27;s public key.</li>
<li>Sign with your own root private key. Since the public key can be extracted from the signature, it confirms your identity.</li>
<li>Set the counterparty&#x27;s public key HASH.</li>
<li>The recipient can verify the plaintext Hash256 after decrypting the data.</li>
</ol>
<p><code>Pubkeyhash PlaintextHash EncryptedData Signature 00 NOTE</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-nft">4. NFT<a href="#4-nft" class="hash-link" aria-label="Direct link to 4. NFT" title="Direct link to 4. NFT">​</a></h2>
<p>Due to the vision and technical limitations of the Bitcoin blockchain, this protocol does not require nor recommend storing a large amount of NFT data on the blockchain. It is sufficient to record only the HASH of the NFT data on the chain, with the actual data being stored in other decentralized or centralized systems.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-token">5. Token<a href="#5-token" class="hash-link" aria-label="Direct link to 5. Token" title="Direct link to 5. Token">​</a></h2>
<p>TODO</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-data-indexing">6. Data Indexing<a href="#6-data-indexing" class="hash-link" aria-label="Direct link to 6. Data Indexing" title="Direct link to 6. Data Indexing">​</a></h2>
<p>TODO</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="61-asset-proof">6.1 Asset Proof<a href="#61-asset-proof" class="hash-link" aria-label="Direct link to 6.1 Asset Proof" title="Direct link to 6.1 Asset Proof">​</a></h3>
<p>TODO</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-references">7. References<a href="#7-references" class="hash-link" aria-label="Direct link to 7. References" title="Direct link to 7. References">​</a></h2>
<p>Special thanks to the following individuals and teams, listed and unlisted, for their contributions to Bitcoin. Their articles and code have provided us with much inspiration.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bitcoin">Bitcoin<a href="#bitcoin" class="hash-link" aria-label="Direct link to Bitcoin" title="Direct link to Bitcoin">​</a></h3>
<p><a href="https://bitcoin.org/bitcoin.pdf" target="_blank" rel="noopener noreferrer">White Paper</a> - The unshakeable Bitcoin protocol.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bip32">BIP32<a href="#bip32" class="hash-link" aria-label="Direct link to BIP32" title="Direct link to BIP32">​</a></h3>
<p><a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" target="_blank" rel="noopener noreferrer">BIP32</a> defines a set of algorithms for deriving private keys from mnemonic phrases. Through private keys, corresponding public keys and public key hashes (i.e., addresses) can be obtained.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="electrum-bie1-ecies">Electrum BIE1 ECIES<a href="#electrum-bie1-ecies" class="hash-link" aria-label="Direct link to Electrum BIE1 ECIES" title="Direct link to Electrum BIE1 ECIES">​</a></h3>
<p><a href="https://github.com/benw46/BIE1" target="_blank" rel="noopener noreferrer">Electrum BIE1 ECIES</a> defines how to encrypt and decrypt data using elliptic curve algorithms.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="paymail">Paymail<a href="#paymail" class="hash-link" aria-label="Direct link to Paymail" title="Direct link to Paymail">​</a></h3>
<p><a href="https://bsvalias.org/" target="_blank" rel="noopener noreferrer">Paymail</a> inspired the design of DID.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ordinals">Ordinals<a href="#ordinals" class="hash-link" aria-label="Direct link to Ordinals" title="Direct link to Ordinals">​</a></h3>
<p><a href="https://docs.ordinals.com/" target="_blank" rel="noopener noreferrer">Ordinals</a> prompted us to upgrade the protocol.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="brc-20">BRC-20<a href="#brc-20" class="hash-link" aria-label="Direct link to BRC-20" title="Direct link to BRC-20">​</a></h3>
<p><a href="https://domo-2.gitbook.io/brc-20-experiment/" target="_blank" rel="noopener noreferrer">BRC-20</a> suggestions for standard data formats.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="atomicals">Atomicals<a href="#atomicals" class="hash-link" aria-label="Direct link to Atomicals" title="Direct link to Atomicals">  ​</a></h3>
<p><a href="https://docs.atomicals.xyz/" target="_blank" rel="noopener noreferrer">Atomicals</a> helped us better understand the requirements.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scrypt">Scrypt<a href="#scrypt" class="hash-link" aria-label="Direct link to Scrypt" title="Direct link to Scrypt">​</a></h3>
<p><a href="https://Scrypt.io" target="_blank" rel="noopener noreferrer">Scrypt</a> Smart Contract for Bitcoin</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="msgpack">Msgpack<a href="#msgpack" class="hash-link" aria-label="Direct link to Msgpack" title="Direct link to Msgpack">​</a></h3>
<p><a href="https://msgpack.org/" target="_blank" rel="noopener noreferrer">Msgpack</a> Save every byte.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Protocol/NOTE-Protocol-V2-Chinese"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">NOTE协议(draft)</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-introduction" class="table-of-contents__link toc-highlight">1. Introduction</a></li><li><a href="#2-problems-solved-and-solutions-by-the-protocol" class="table-of-contents__link toc-highlight">2. Problems Solved and Solutions by the Protocol</a><ul><li><a href="#21-system-relationship-diagram" class="table-of-contents__link toc-highlight">2.1 System Relationship Diagram</a></li><li><a href="#22-decentralized-id" class="table-of-contents__link toc-highlight">2.2 Decentralized ID</a></li><li><a href="#23-data-format-and-order" class="table-of-contents__link toc-highlight">2.3 Data Format and Order</a></li><li><a href="#24-storage-location" class="table-of-contents__link toc-highlight">2.4 Storage Location</a></li><li><a href="#25-on-chain-contracts" class="table-of-contents__link toc-highlight">2.5 On-Chain Contracts</a></li><li><a href="#26-data-ownership-confirmation" class="table-of-contents__link toc-highlight">2.6 Data Ownership Confirmation</a></li><li><a href="#27-transfer-of-ownership" class="table-of-contents__link toc-highlight">2.7 Transfer of Ownership</a></li><li><a href="#28-data-parsing" class="table-of-contents__link toc-highlight">2.8 Data Parsing</a></li></ul></li><li><a href="#3-encrypted-data" class="table-of-contents__link toc-highlight">3. Encrypted Data</a><ul><li><a href="#31-creation-of-data" class="table-of-contents__link toc-highlight">3.1 Creation of Data</a></li><li><a href="#32-sharing-of-signed-encrypted-data" class="table-of-contents__link toc-highlight">3.2 Sharing of Signed Encrypted Data</a></li></ul></li><li><a href="#4-nft" class="table-of-contents__link toc-highlight">4. NFT</a></li><li><a href="#5-token" class="table-of-contents__link toc-highlight">5. Token</a></li><li><a href="#6-data-indexing" class="table-of-contents__link toc-highlight">6. Data Indexing</a><ul><li><a href="#61-asset-proof" class="table-of-contents__link toc-highlight">6.1 Asset Proof</a></li></ul></li><li><a href="#7-references" class="table-of-contents__link toc-highlight">7. References</a><ul><li><a href="#bitcoin" class="table-of-contents__link toc-highlight">Bitcoin</a></li><li><a href="#bip32" class="table-of-contents__link toc-highlight">BIP32</a></li><li><a href="#electrum-bie1-ecies" class="table-of-contents__link toc-highlight">Electrum BIE1 ECIES</a></li><li><a href="#paymail" class="table-of-contents__link toc-highlight">Paymail</a></li><li><a href="#ordinals" class="table-of-contents__link toc-highlight">Ordinals</a></li><li><a href="#brc-20" class="table-of-contents__link toc-highlight">BRC-20</a></li><li><a href="#atomicals" class="table-of-contents__link toc-highlight">Atomicals</a></li><li><a href="#scrypt" class="table-of-contents__link toc-highlight">Scrypt</a></li><li><a href="#msgpack" class="table-of-contents__link toc-highlight">Msgpack</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://x.com/NoteProtocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">X / Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/NoteProtocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Note Protocol. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>