"use strict";(self.webpackChunknote_protocol=self.webpackChunknote_protocol||[]).push([[5727],{829:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>l});var s=n(6070),o=n(5296);const i={title:"",sidebar_position:2.4,sidebar_label:"On-Chain Contracts"},a=void 0,r={id:"protocol/Problems And Solutions/2.4-Contracts",title:"",description:"2.4 On-Chain Contracts",source:"@site/docs/protocol/02-Problems And Solutions/2.4-Contracts.md",sourceDirName:"protocol/02-Problems And Solutions",slug:"/protocol/Problems And Solutions/2.4-Contracts",permalink:"/docs/protocol/Problems And Solutions/2.4-Contracts",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2.4,frontMatter:{title:"",sidebar_position:2.4,sidebar_label:"On-Chain Contracts"},sidebar:"docsSidebar",previous:{title:"Storage Locations",permalink:"/docs/protocol/Problems And Solutions/2.3-Location"},next:{title:"Security Precautions",permalink:"/docs/protocol/Problems And Solutions/2.5-Security"}},c={},l=[{value:"2.4 On-Chain Contracts",id:"24-on-chain-contracts",level:3},{value:"2.4.1 Multisignature",id:"241-multisignature",level:4},{value:"2.4.2 Advanced Contracts",id:"242-advanced-contracts",level:3}];function d(t){const e={code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...t.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h3,{id:"24-on-chain-contracts",children:"2.4 On-Chain Contracts"}),"\n",(0,s.jsx)(e.p,{children:"Utilizing the combination of unlock and redeem scripts to define the data area for NOTE allows the incorporation of complex scripts, such as multi-signatures and hash locks, outside the data area."}),"\n",(0,s.jsx)(e.h4,{id:"241-multisignature",children:"2.4.1 Multisignature"}),"\n",(0,s.jsx)(e.p,{children:"A contract for multisignature might look like this:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Lock script: ",(0,s.jsx)(e.code,{children:"NOTE OP_2DROP OP_2DROP OP_2DROP <m> <A pubkey> [B pubkey] [C pubkey...] <n> OP_CHECKMULTISIG"})]}),"\n",(0,s.jsxs)(e.li,{children:["Unlock script: ",(0,s.jsx)(e.code,{children:"OP_0 <A sig> [B sig] [C sig...] DATA0 DATA1 DATA2 DATA3 Flag"})]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"Multisignature can also be effectively created with the correct redeem script using P2SH/P2WSH/P2TR."}),"\n",(0,s.jsx)(e.h3,{id:"242-advanced-contracts",children:"2.4.2 Advanced Contracts"}),"\n",(0,s.jsx)(e.p,{children:"By employing more sophisticated lock scripts, on-chain smart contracts that only allow transactions meeting specific criteria to be added to the blockchain can be developed. Here's an easy example of a hash lock contract that mandates a particular message besides the signature to initiate a transaction, enabling the recording of information on the blockchain."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"class HashLock extends SmartContract {\n    @prop()\n    static note: ByteString = toByteString('NOTE', true)\n\n    @prop()\n    pubKey: PubKey\n\n    @prop()\n    hash: ByteString\n\n    constructor(pubKey: PubKey, hash: Sha256) {\n        super(...arguments)\n        this.pubKey = pubKey\n        this.hash = hash\n    }\n\n    @method()\n    public unlock(\n        sig: Sig, \n        message: ByteString,\n        data0: ByteString,\n        data1: ByteString,\n        data2: ByteString,\n        data3: ByteString,\n        data4: ByteString\n    ) {\n        Scryptdemo.note\n        assert(sha256(message) == this.hash, 'Hash does not match')\n        assert(this.checkSig(sig, this.pubKey), 'signature check failed')\n    }\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"The resulting compiled script is:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"044e4f54450000<pubKey><hash>78547a7572537a76537a7577775279755879a8788859795279ac77777777777777777777\n"})}),"\n",(0,s.jsx)(e.p,{children:"ASM stands for:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"4e4f5445 0 0 <pubKey> <hash> OP_OVER OP_4 OP_ROLL OP_DROP OP_2SWAP OP_3 OP_ROLL OP_DUP OP_3 OP_ROLL OP_DROP OP_NIP OP_NIP OP_2 OP_PICK OP_DROP OP_8 OP_PICK OP_SHA256 OP_OVER OP_EQUALVERIFY OP_9 OP_PICK OP_2 OP_PICK OP_CHECKSIG OP_NIP OP_NIP OP_NIP OP_NIP OP_NIP OP_NIP OP_NIP OP_NIP OP_NIP OP_NIP\n"})}),"\n",(0,s.jsx)(e.p,{children:"Example contracts are developed with Scrypt.io. From the simplest scripts to the most complex contracts, within transaction scripts that combine unlock and redeem/lock scripts, the data's format and sequence are required to follow the guidelines established by this protocol."})]})}function h(t={}){const{wrapper:e}={...(0,o.R)(),...t.components};return e?(0,s.jsx)(e,{...t,children:(0,s.jsx)(d,{...t})}):d(t)}},5296:(t,e,n)=>{n.d(e,{R:()=>a,x:()=>r});var s=n(758);const o={},i=s.createContext(o);function a(t){const e=s.useContext(i);return s.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function r(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(o):t.components||o:a(t.components),s.createElement(i.Provider,{value:e},t.children)}}}]);