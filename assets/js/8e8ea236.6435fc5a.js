"use strict";(self.webpackChunknote_protocol=self.webpackChunknote_protocol||[]).push([[5638],{310:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});var s=n(5893),i=n(1151);const o={title:"",sidebar_position:2.4,sidebar_label:"On-Chain Contracts"},a=void 0,r={id:"Problems And Solutions/2.4-Contracts",title:"",description:"2.4 On-Chain Contracts",source:"@site/docs/02-Problems And Solutions/2.4-Contracts.md",sourceDirName:"02-Problems And Solutions",slug:"/Problems And Solutions/2.4-Contracts",permalink:"/docs/Problems And Solutions/2.4-Contracts",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2.4,frontMatter:{title:"",sidebar_position:2.4,sidebar_label:"On-Chain Contracts"},sidebar:"docsSidebar",previous:{title:"Storage Locations",permalink:"/docs/Problems And Solutions/2.3-Location"},next:{title:"Security Precautions",permalink:"/docs/Problems And Solutions/2.5-Security"}},c={},l=[{value:"2.4 On-Chain Contracts",id:"24-on-chain-contracts",level:3},{value:"2.4.1 Multisignature",id:"241-multisignature",level:4},{value:"2.4.2 Advanced Contracts",id:"242-advanced-contracts",level:3}];function d(e){const t={code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h3,{id:"24-on-chain-contracts",children:"2.4 On-Chain Contracts"}),"\n",(0,s.jsx)(t.p,{children:"Utilizing the combination of unlock and redeem scripts to define the data area for NOTE allows the incorporation of complex scripts, such as multi-signatures and hash locks, outside the data area."}),"\n",(0,s.jsx)(t.h4,{id:"241-multisignature",children:"2.4.1 Multisignature"}),"\n",(0,s.jsx)(t.p,{children:"A contract for multisignature might look like this:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Lock script: ",(0,s.jsx)(t.code,{children:"NOTE OP_2DROP OP_2DROP OP_2DROP <m> <A pubkey> [B pubkey] [C pubkey...] <n> OP_CHECKMULTISIG"})]}),"\n",(0,s.jsxs)(t.li,{children:["Unlock script: ",(0,s.jsx)(t.code,{children:"OP_0 <A sig> [B sig] [C sig...] DATA0 DATA1 DATA2 DATA3 Flag"})]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Multisignature can also be effectively created with the correct redeem script using P2SH/P2WSH/P2TR."}),"\n",(0,s.jsx)(t.h3,{id:"242-advanced-contracts",children:"2.4.2 Advanced Contracts"}),"\n",(0,s.jsx)(t.p,{children:"By employing more sophisticated lock scripts, on-chain smart contracts that only allow transactions meeting specific criteria to be added to the blockchain can be developed. Here's an easy example of a hash lock contract that mandates a particular message besides the signature to initiate a transaction, enabling the recording of information on the blockchain."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:"class HashLock extends SmartContract {\n    @prop()\n    static note: ByteString = toByteString('NOTE', true)\n\n    @prop()\n    pubKey: PubKey\n\n    @prop()\n    hash: ByteString\n\n    constructor(pubKey: PubKey, hash: Sha256) {\n        super(...arguments)\n        this.pubKey = pubKey\n        this.hash = hash\n    }\n\n    @method()\n    public unlock(\n        sig: Sig, \n        message: ByteString,\n        data0: ByteString,\n        data1: ByteString,\n        data2: ByteString,\n        data3: ByteString,\n        data4: ByteString\n    ) {\n        Scryptdemo.note\n        assert(sha256(message) == this.hash, 'Hash does not match')\n        assert(this.checkSig(sig, this.pubKey), 'signature check failed')\n    }\n}\n"})}),"\n",(0,s.jsx)(t.p,{children:"The resulting compiled script is:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"044e4f54450000<pubKey><hash>78547a7572537a76537a7577775279755879a8788859795279ac77777777777777777777\n"})}),"\n",(0,s.jsx)(t.p,{children:"ASM stands for:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"4e4f5445 0 0 <pubKey> <hash> OP_OVER OP_4 OP_ROLL OP_DROP OP_2SWAP OP_3 OP_ROLL OP_DUP OP_3 OP_ROLL OP_DROP OP_NIP OP_NIP OP_2 OP_PICK OP_DROP OP_8 OP_PICK OP_SHA256 OP_OVER OP_EQUALVERIFY OP_9 OP_PICK OP_2 OP_PICK OP_CHECKSIG OP_NIP OP_NIP OP_NIP OP_NIP OP_NIP OP_NIP OP_NIP OP_NIP OP_NIP OP_NIP\n"})}),"\n",(0,s.jsx)(t.p,{children:"Example contracts are developed with Scrypt.io. From the simplest scripts to the most complex contracts, within transaction scripts that combine unlock and redeem/lock scripts, the data's format and sequence are required to follow the guidelines established by this protocol."})]})}function h(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>r,a:()=>a});var s=n(7294);const i={},o=s.createContext(i);function a(e){const t=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);